技术选型 (基于Next.js + Vercel)

为满足轻量、易开发和易维护的要求，本方案采用现代化的全栈技术栈：

- 全栈框架：采用 Next.js 14+ 作为全栈框架，集成前后端开发。Next.js 提供了完整的全栈解决方案，包括服务端渲染(SSR)、静态生成(SSG)、API Routes等功能。使用 TypeScript 开发，提供更好的类型安全和开发体验。Next.js 原生支持 React 18 的最新特性，并且有优秀的性能优化和开发者体验。
  
- 前端技术：基于 React 18 构建现代化的用户界面，搭配 Tailwind CSS 实现响应式设计和快速样式开发。使用 shadcn/ui 或 Ant Design 等成熟的组件库提升开发效率。Next.js 的 App Router 提供了更好的路由管理和布局系统，支持嵌套路由和并行路由等高级特性。前端状态管理可使用 Zustand 或 React Query 处理服务端状态同步。
  
- 后端API：利用 Next.js 的 API Routes 功能构建后端服务，无需单独的后端框架。API Routes 支持中间件、请求验证、错误处理等功能。使用 Prisma 作为 ORM 工具，提供类型安全的数据库操作和自动生成的客户端。后端逻辑主要包括 n8n API 代理、数据库操作、认证授权等功能。
  
- 数据库：使用 Supabase 进行快速原型开发。支持数据库迁移和种子数据，便于版本控制和团队协作。数据库设计保持轻量级，主要存储 n8n 实例配置、工作流缓存和执行记录等。
  
- 部署与运行：使用 Vercel 进行一键部署，享受零配置的 CI/CD 流程。Vercel 提供了优秀的性能优化、全球CDN、自动HTTPS等功能。支持预览部署、环境变量管理、监控告警等企业级功能。数据库可使用 Vercel 集成的 Neon PostgreSQL 或 Supabase，实现无服务器架构。静态资源自动优化和缓存，API Routes 自动部署为 Serverless Functions。
  
  
以上选型充分利用了 Next.js 生态系统的优势，实现了真正的全栈开发体验。Vercel 的无服务器部署模式降低了运维成本，同时保证了良好的性能和扩展性。

系统架构与模块划分

平台采用 Next.js 全栈架构，由**前端页面**、**API Routes**和**数据库**三部分组成。各模块功能与交互关系如下：

- 前端页面模块：基于 Next.js App Router 构建的现代化Web界面，提供完整的 n8n 实例管理功能：
  
  - 实例管理页面 (/instances)：使用 Server Components 和 Client Components 混合渲染，列出所有 n8n 实例，提供添加/编辑/删除实例的表单界面。
  - 工作流列表页面 (/instances/[id]/workflows)：动态路由页面，按实例显示工作流列表，支持实时搜索和筛选功能。
  - 执行记录页面 (/executions)：展示执行历史记录，支持分页、筛选和实时状态更新。
  - 仪表板页面 (/dashboard)：提供系统概览、统计图表和快速操作入口。
    
    前端使用 React Server Components 进行服务端渲染，提升首屏加载速度。客户端交互使用 React Query 管理服务端状态，实现乐观更新和自动重试。UI 组件基于 Tailwind CSS 和 shadcn/ui 构建，确保一致的设计语言和良好的用户体验。
    
- API Routes 模块：基于 Next.js API Routes 构建的后端服务，提供 RESTful API：
  
  1. 实例管理API (/api/instances/*)：
    - GET /api/instances - 获取实例列表
    - POST /api/instances - 创建新实例
    - PUT /api/instances/[id] - 更新实例配置
    - DELETE /api/instances/[id] - 删除实例
    - POST /api/instances/[id]/test - 测试实例连接
      
  2. 工作流管理API (/api/workflows/*)：
    - GET /api/instances/[id]/workflows - 获取实例的工作流列表
    - POST /api/workflows/[id]/execute - 执行指定工作流
    - GET /api/workflows/[id]/status - 获取工作流状态
      
  3. 执行记录API (/api/executions/*)：
    - GET /api/executions - 获取执行记录列表
    - GET /api/executions/[id] - 获取执行详情
    - POST /api/executions/[id]/retry - 重试失败的执行
      
      API Routes 使用 Zod 进行请求验证，**Prisma** 进行数据库操作。错误处理统一使用 Next.js 的错误边界和自定义错误页面。
      
- 数据库模块：
  - 使用 Supabase 进行数据库存储，支持数据库迁移和种子数据。
  - 数据库设计保持与原方案一致，主要存储 n8n 实例配置、工作流缓存和执行记录等。
  - 数据库表结构如下：
    - instances - n8n 实例配置表
    - workflows - 工作流缓存表
    - executions - 执行记录表
    - executions_workflows - 执行记录与工作流关联表
      
各模块通过 Next.js 的文件系统路由和 API Routes 进行交互，遵循现代全栈开发模式。前端页面可以直接调用同域的 API Routes，避免跨域问题。使用 TypeScript 确保前后端类型一致性，提升开发效率和代码质量。

部署与运维 (Vercel 平台)

Vercel 部署配置

1. 项目配置：
// vercel.json
{
  "framework": "nextjs",
  "buildCommand": "npm run build",
  "devCommand": "npm run dev",
  "installCommand": "npm install",
  "functions": {
    "app/api/**/*.ts": {
      "maxDuration": 30
    }
  }
}
  